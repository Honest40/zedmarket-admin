<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZedMarket Admin Pro ðŸ‡¿ðŸ‡²</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f2f2f2}
header{background:#0f2a44;color:#fff;padding:15px;text-align:center;font-size:22px}
button{padding:6px 10px;margin:2px;border:none;border-radius:4px;cursor:pointer;color:#fff;background:#198754}
button.reject{background:#dc3545}
button.feature{background:#ffc107;color:#000}
button.verify{background:#0d6efd}
section{padding:15px}
h3{margin-top:20px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
.badge{background:#0d6efd;color:#fff;padding:2px 6px;border-radius:3px;font-size:12px}
.notification{background:#ffc107;color:#000;padding:5px;margin-bottom:5px;border-radius:4px}
</style>
</head>
<body>

<header>ZedMarket Admin Pro ðŸ‡¿ðŸ‡²</header>

<section id="loginSection">
<h3>Admin Login</h3>
<input id="adminEmail" placeholder="Email" value="hbforlife40@gmail.com">
<input id="adminPassword" type="password" placeholder="Password" value="mother">
<button id="adminLoginBtn">Login</button>
</section>

<section id="adminPanel" style="display:none">
<button id="adminLogoutBtn">Logout</button>
<div id="notifications"></div>

<h3>All Listings</h3>
<input type="text" id="listingSearch" placeholder="Search listings by title...">
<select id="listingFilter">
  <option value="">All Types</option>
  <option value="product">Product</option>
  <option value="service">Service</option>
</select>
<table>
<tr><th>Title</th><th>Seller</th><th>Status</th><th>Actions</th></tr>
<tbody id="allListings"></tbody>
</table>

<h3>All Users</h3>
<input type="text" id="userSearch" placeholder="Search users by name...">
<table>
<tr><th>Name</th><th>Phone</th><th>Verified</th><th>Role</th><th>Actions</th></tr>
<tbody id="allUsers"></tbody>
</table>
</section>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
window.addEventListener('load',()=>{
const firebaseConfig={
apiKey:"AIzaSyDhRFgn7nXoZlRf-GX7XakwUYrEMFZDgrI",
authDomain:"pa-mwera.firebaseapp.com",
databaseURL:"https://pa-mwera-default-rtdb.firebaseio.com",
projectId:"pa-mwera",
storageBucket:"pa-mwera.firebasestorage.app",
messagingSenderId:"959795010421",
appId:"1:959795010421:web:84e1cc1517a5d98598113c"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

// DOM elements
const loginSection=document.getElementById("loginSection");
const adminPanel=document.getElementById("adminPanel");
const adminEmail=document.getElementById("adminEmail");
const adminPassword=document.getElementById("adminPassword");
const adminLoginBtn=document.getElementById("adminLoginBtn");
const adminLogoutBtn=document.getElementById("adminLogoutBtn");
const notifications=document.getElementById("notifications");

const allListings=document.getElementById("allListings");
const listingSearch=document.getElementById("listingSearch");
const listingFilter=document.getElementById("listingFilter");

const allUsers=document.getElementById("allUsers");
const userSearch=document.getElementById("userSearch");

// Admin login - simplified
adminLoginBtn.onclick=async()=>{
try{
const cred=await auth.signInWithEmailAndPassword(adminEmail.value,adminPassword.value);
if(adminEmail.value!=="hbforlife40@gmail.com"){
  alert("Not authorized!"); await auth.signOut(); return;
}
loginSection.style.display="none";
adminPanel.style.display="block";
loadListings(); loadUsers(); listenNotifications();
}catch(e){alert("Login failed: "+e.message);}
};

// Admin logout
adminLogoutBtn.onclick=async()=>{
await auth.signOut();
loginSection.style.display="block";
adminPanel.style.display="none";
};

// LISTINGS
async function loadListings(){
const snapshot=await db.collection("listings").orderBy("createdAt","desc").get();
allListings.innerHTML="";
snapshot.forEach(doc=>{
const d=doc.data();
if(d.title.toLowerCase().includes(listingSearch.value.toLowerCase()) && 
(listingFilter.value===""||d.type===listingFilter.value)){
allListings.innerHTML+=`<tr>
<td>${d.title}</td>
<td>${d.sellerId}</td>
<td>${d.status}</td>
<td>
<button onclick="approveListing('${doc.id}')">Approve</button>
<button class="reject" onclick="rejectListing('${doc.id}')">Reject</button>
<button class="feature" onclick="featureListing('${doc.id}',${d.featured})">${d.featured?'Unfeature':'Feature'}</button>
<button onclick="editListing('${doc.id}','${d.title}','${d.type}','${d.price}','${d.image}','${d.whatsapp}','${d.description}')">Edit</button>
<button onclick="deleteListing('${doc.id}')">Delete</button>
</td>
</tr>`;
}
});
}
listingSearch.addEventListener("input",loadListings);
listingFilter.addEventListener("change",loadListings);

window.approveListing=async(id)=>{await db.collection("listings").doc(id).update({status:"approved"});loadListings();}
window.rejectListing=async(id)=>{await db.collection("listings").doc(id).update({status:"rejected"});loadListings();}
window.featureListing=async(id,featured)=>{await db.collection("listings").doc(id).update({featured:!featured});loadListings();}
window.deleteListing=async(id)=>{if(confirm("Delete this listing?")){await db.collection("listings").doc(id).delete();loadListings();}}

// EDIT listing
window.editListing=async(id,t,type,price,img,wa,desc)=>{
const newTitle=prompt("Edit title",t);
if(newTitle===null) return;
await db.collection("listings").doc(id).update({title:newTitle,type:type,price:price,image:img,whatsapp:wa,description:desc,status:"pending"});
loadListings();
alert("Listing updated and pending approval!");
}

// USERS
async function loadUsers(){
const snapshot=await db.collection("users").get();
allUsers.innerHTML="";
snapshot.forEach(doc=>{
const d=doc.data();
if(d.name.toLowerCase().includes(userSearch.value.toLowerCase())){
allUsers.innerHTML+=`<tr>
<td>${d.name||"N/A"}</td>
<td>${d.phone||"N/A"}</td>
<td>${d.isVerified?'<span class="badge">Verified</span>':'No'}</td>
<td>${d.role||"user"}</td>
<td>
<button class="verify" onclick="verifyUser('${doc.id}',${d.isVerified})">${d.isVerified?'Unverify':'Verify'}</button>
<button onclick="deleteUser('${doc.id}')">Delete</button>
</td>
</tr>`;
}
});
}
userSearch.addEventListener("input",loadUsers);

window.verifyUser=async(id,isVerified)=>{await db.collection("users").doc(id).update({isVerified:!isVerified});loadUsers();}
window.deleteUser=async(id)=>{if(confirm("Delete this user?")){await db.collection("users").doc(id).delete();loadUsers();}}

// Notifications
function listenNotifications(){
db.collection("listings").where("status","==","pending")
.onSnapshot(snapshot=>{
snapshot.docChanges().forEach(change=>{
if(change.type==="added"){const d=change.doc.data();showNotification(`New listing submitted: ${d.title}`);}
});
});
db.collection("users")
.onSnapshot(snapshot=>{
snapshot.docChanges().forEach(change=>{
if(change.type==="added"){const d=change.doc.data();showNotification(`New user registered: ${d.name||d.phone}`);}
});
});
}

function showNotification(msg){
const n=document.createElement("div");
n.className="notification";
n.textContent=msg;
notifications.prepend(n);
setTimeout(()=>n.remove(),7000);
}

});
</script>
</body>
</html>
